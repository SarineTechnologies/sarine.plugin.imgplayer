!function(v){v.imgplay=function(e,a){var n={startImage:0,totalImages:null,imageName:null,urlDir:null,rate:null,height:null,width:null,autoPlay:!0,autoReverse:!1},i=v(e),s=null,r=null,o=!1,m="forward",f=0,h=0,l=null,t=0,g=0,p=this;p.settings={},p.frames=[],p.init=function(){var e;p.settings=v.extend({},n,a),Object.keys(p.settings).map(function(e,t){null===p.settings[e]&&console.error("Sarine imageplayer error: "+e+" is undefined in plugin configuration")}),-1===p.settings.urlDir.indexOf("{num}")&&console.error("Sarine imageplayer error: urlDir should contain {num} string in the image name, like: Image_{num}.jpg"),f=p.settings.totalImages;for(var t=p.settings.startImage;t<p.settings.totalImages+p.settings.startImage;++t)e='<img class="imageplay_loaded" src="'+p.settings.urlDir.replace("{num}",t)+'" />',i.append(e),p.frames[t+1]=v(e).get(0);i.addClass("sarine_imgplay"),i.css({height:a.height,width:a.width}),(s=v('<canvas class="imgplay-canvas">')).prop({height:a.height,width:a.width}),r=s.get(0).getContext("2d"),i.append(s),u(),i.find("img.imageplay_loaded").detach(),p.settings.rate||(p.settings.rate=parseInt(p.frames.length/10)),p.settings.rate=p.settings.rate<.001?.001:p.settings.rate,p.settings.rate=100<p.settings.rate?100:p.settings.rate,p.settings.autoPlay?p.play():setTimeout(function(){p.toFrame(p.settings.startImage)},500)},p.play=function(){o=!0,null!=l&&clearTimeout(l),c(),i.trigger("play")},p.pause=function(){o=!1,null!=l&&clearTimeout(l),i.trigger("pause")},p.stop=function(){o=!1,h=0,p.settings.autoReverse&&p.frames.reverse(),p.play(),i.trigger("stop",p)},p.toFrame=function(e){if(e=e<0?0:e,p.frames[e])return h=e,c(),v.Deferred().resolve()};var u=function(){var o=v('<div class="imgplay-progress" id="imgplay_move">'),e=v('<div class="imgplay-play-bar">');function l(e,t){return(t.originalEvent&&t.originalEvent.touches?(t.originalEvent&&t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]).pageX:t.pageX)-e.offset().left}var g=!1,u=-1;mousePosOnMouseDown=-1,curPosX=0,prevPosX=0,isRightDirection=!1,o.on("mousedown touchstart",function(e){var t;e.preventDefault(),t=e,p.pause(),g=!0,mousePosOnMouseDown=l(o,t),u=h}).on("mousemove touchmove",function(e){e.preventDefault(),function(e){if(g){var t=o,a=l(t,e),n=t.width();Math.floor(a/n*f),isRightDirection=a>=prevPosX,m=isRightDirection?"forward":"backward";var i,s=Math.floor(f/n*mousePosOnMouseDown),r=Math.floor(f/n*a);r>=mousePosOnMouseDown?(i=Math.floor(r-s),h=u+i):(i=Math.floor(s-r),h=u-i),f<h?h-=f:h<1&&(h=f+h),p.toFrame(h),prevPosX=a}}(e)}).on("mouseleave mouseup touchend",function(e){p.play(),g=!1}),o.append(e),i.append(o)},c=function(){if(null!=r){var e=p.frames[h],t=v(e);if(e&&0<t.prop("naturalHeight")&&(r.clearRect(0,0,a.width,a.height),r.drawImage(e,0,0,a.width,a.height)),h>p.frames.length)return void p.stop();o&&("forward"==m?h++:--h<0&&(h=p.frames.length+h),l=setTimeout(c,Math.ceil(1e3/p.settings.rate))),d()}},d=function(){t=p.frames.length/f*100,g=h/p.frames.length*100,t=100<t?100:t,g=100<g?100:g,i.find(".imgplay-play-bar").css("width",g+"%")};p.init()},v.fn.imgplay=function(t){return this.each(function(){if(null==v(this).data("imgplay")){var e=new v.imgplay(this,t);v(this).data("imgplay",e)}}),this}}(jQuery);
//# sourceMappingURL=sarine.plugin.imgplayer.min.js.map
