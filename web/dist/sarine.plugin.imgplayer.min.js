!function(y){y.imgplay=function(e,n){var i={totalImages:null,imageName:null,urlDir:null,rate:null,height:null,width:null,autoPlay:!0},a=y(e),l=null,g=null,u=!1,m="forward",h=0,f=0,p=null,t=0,r=0,c=this;c.settings={},c.frames=[],c.init=function(){var e;c.settings=y.extend({},i,n),Object.keys(c.settings).map(function(e,t){null===c.settings[e]&&console.error("Sarine imageplayer error: "+e+" is undefined in plugin configuration")}),-1===c.settings.urlDir.indexOf("{num}")&&console.error("Sarine imageplayer error: urlDir should contain {num} string in the image name, like: Image_{num}.jpg"),h=c.settings.totalImages;for(var t=1;t<=c.settings.totalImages;++t)e='<img class="imageplay_loaded" src="'+c.settings.urlDir.replace("{num}",t)+'" />',a.append(e),c.frames[t]=y(e).get(0);a.addClass("sarine_imgplay"),a.css({height:n.height,width:n.width}),(l=y('<canvas class="imgplay-canvas">')).prop({height:n.height,width:n.width}),g=l.get(0).getContext("2d"),a.append(l),s(),a.find("img.imageplay_loaded").detach(),c.settings.rate||(c.settings.rate=parseInt(c.frames.length/10)),c.settings.rate=c.settings.rate<.001?.001:c.settings.rate,c.settings.rate=100<c.settings.rate?100:c.settings.rate,c.settings.autoPlay?c.play():c.toFrame(1)},c.play=function(){u=!0,null!=p&&clearTimeout(p),d(),a.trigger("play")},c.pause=function(){u=!1,null!=p&&clearTimeout(p),a.trigger("pause")},c.stop=function(){u=!1,f=0,c.play(),a.trigger("stop",c)},c.toFrame=function(e){if(e=e<0?0:e,c.frames[e])return f=e,d(),y.Deferred().resolve()};var s=function(){var o=y('<div class="imgplay-progress" id="imgplay_move">'),e=y('<div class="imgplay-play-bar">');function l(e,t){return(t.originalEvent&&t.originalEvent.touches?(t.originalEvent&&t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]).pageX:t.pageX)-e.offset().left}var g=!1,u=-1;mousePosOnMouseDown=-1,curPosX=0,prevPosX=0,isRightDirection=!1,o.on("mousedown touchstart",function(e){var t;e.preventDefault(),t=e,c.pause(),g=!0,mousePosOnMouseDown=l(o,t),u=f}).on("mousemove touchmove",function(e){e.preventDefault(),function(e){if(g){var t=o,n=l(t,e),i=t.width();Math.floor(n/i*h),isRightDirection=n>=prevPosX,m=isRightDirection?"forward":"backward";var a,r=Math.floor(h/i*mousePosOnMouseDown),s=Math.floor(h/i*n);s>=mousePosOnMouseDown?(a=Math.floor(s-r),f=u+a):(a=Math.floor(r-s),f=u-a),h<f?f-=h:f<1&&(f=h+f),c.toFrame(f),prevPosX=n}}(e)}).on("mouseleave mouseup touchend",function(e){c.play(),g=!1}),o.append(e),a.append(o)},d=function(){if(null!=g){var e=c.frames[f],t=y(e);if(e&&0<t.prop("naturalHeight")){var n=l.width(),i=l.height(),a=e.width,r=e.height,s=0,o=0;i<=n?(s=a*(i/r),o=i):o=r*((s=n)/a),g.clearRect(0,0,n,i),g.drawImage(e,(n-s)/2,(i-o)/2,s,o)}if(f>c.frames.length)return void c.stop();u&&("forward"==m?f++:--f<0&&(f=c.frames.length+f),p=setTimeout(d,Math.ceil(1e3/c.settings.rate))),v()}},v=function(){t=c.frames.length/h*100,r=f/c.frames.length*100,t=100<t?100:t,r=100<r?100:r,a.find(".imgplay-play-bar").css("width",r+"%")};c.init()},y.fn.imgplay=function(t){return this.each(function(){if(null==y(this).data("imgplay")){var e=new y.imgplay(this,t);y(this).data("imgplay",e)}}),this}}(jQuery);
//# sourceMappingURL=sarine.plugin.imgplayer.min.js.map
