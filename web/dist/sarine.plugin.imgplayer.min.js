!function(v){v.imgplay=function(e,n){var a={startImage:0,totalImages:null,imageName:null,urlDir:null,rate:null,height:null,width:null,autoPlay:!0,autoReverse:!1,userInteraction:!0},i=v(e),s=null,r=null,o=!1,m="forward",c=0,f=0,l=null,t=0,g=0,h=this;h.settings={},h.frames=[],h.init=function(){var t;h.settings=v.extend({},a,n),Object.keys(h.settings).map(function(e,t){null===h.settings[e]&&console.error("Sarine imageplayer error: "+e+" is undefined in plugin configuration")}),-1===h.settings.urlDir.indexOf("{num}")&&console.error("Sarine imageplayer error: urlDir should contain {num} string in the image name, like: Image_{num}.jpg"),c=h.settings.totalImages,t='<img src="'+h.settings.urlDir.replace("{num}",h.settings.startImage)+'" />',v(t).get(0).onload=function(){for(var e=h.settings.startImage;e<h.settings.totalImages+h.settings.startImage;++e)t='<img class="imageplay_loaded" src="'+h.settings.urlDir.replace("{num}",e)+'" />',i.append(t),h.frames[e+1]=v(t).get(0);i.addClass("sarine_imgplay"),i.css({height:n.height,width:n.width}),(s=v('<canvas class="imgplay-canvas">')).prop({height:n.height,width:n.width}),r=s.get(0).getContext("2d"),i.append(s),u(),i.find("img.imageplay_loaded").detach(),h.settings.rate||(h.settings.rate=parseInt(h.frames.length/10)),h.settings.rate=h.settings.rate<.001?.001:h.settings.rate,h.settings.rate=100<h.settings.rate?100:h.settings.rate,h.settings.autoPlay?h.play():setTimeout(function(){h.toFrame(0==h.settings.startImage?1:h.settings.startImage)},500)}},h.play=function(){o=!0,null!=l&&clearTimeout(l),p(),i.trigger("play")},h.pause=function(){o=!1,null!=l&&clearTimeout(l),i.trigger("pause")},h.stop=function(){o=!1,f=0,h.settings.autoReverse&&(h.frames.reverse(),f=h.frames[f]?f+1:f+2),h.play(),i.trigger("stop",h)},h.toFrame=function(e){if(e=e<0?0:e,h.frames[e])return f=e,p(),v.Deferred().resolve()};var u=function(){var o=v('<div class="imgplay-progress" id="imgplay_move">'),e=v('<div class="imgplay-play-bar">');function l(e,t){return(t.originalEvent&&t.originalEvent.touches?(t.originalEvent&&t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]).pageX:t.pageX)-e.offset().left}var g=!1,u=-1;mousePosOnMouseDown=-1,curPosX=0,prevPosX=0,isRightDirection=!1,h.settings.userInteraction&&o.on("mousedown touchstart",function(e){var t;e.preventDefault(),t=e,h.pause(),g=!0,mousePosOnMouseDown=l(o,t),u=f}).on("mousemove touchmove",function(e){e.preventDefault(),function(e){if(g){var t=o,n=l(t,e),a=t.width();Math.floor(n/a*c),isRightDirection=n>=prevPosX,m=isRightDirection?"forward":"backward";var i,s=Math.floor(c/a*mousePosOnMouseDown),r=Math.floor(c/a*n);r>=mousePosOnMouseDown?(i=Math.floor(r-s),f=u+i):(i=Math.floor(s-r),f=u-i),c<f?f-=c:f<1&&(f=c+f),h.toFrame(f),prevPosX=n}}(e)}).on("mouseleave mouseup touchend",function(e){h.play(),g=!1}),o.append(e),i.append(o)},p=function(){if(null!=r){var e=h.frames[f],t=v(e);if(e&&0<t.prop("naturalHeight")&&(r.clearRect(0,0,n.width,n.height),r.drawImage(e,0,0,n.width,n.height)),f>h.frames.length)return void h.stop();o&&("forward"==m?f++:--f<0&&(f=h.frames.length+f),l=setTimeout(p,Math.ceil(1e3/h.settings.rate))),d()}},d=function(){t=h.frames.length/c*100,g=f/h.frames.length*100,t=100<t?100:t,g=100<g?100:g,i.find(".imgplay-play-bar").css("width",g+"%")};h.init()},v.fn.imgplay=function(t){return this.each(function(){if(null==v(this).data("imgplay")){var e=new v.imgplay(this,t);v(this).data("imgplay",e)}}),this}}(jQuery);
//# sourceMappingURL=sarine.plugin.imgplayer.min.js.map
