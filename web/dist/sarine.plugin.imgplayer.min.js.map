{"version":3,"sources":["sarine.plugin.imgplayer.js"],"names":["$","imgplay","element","options","defaults","totalImages","imageName","urlDir","rate","height","width","autoPlay","$el","$canvas","screen","playing","direction","total","index","playTimer","loadProgress","playProgress","plugin","this","settings","frames","init","img","extend","Object","keys","map","key","console","error","indexOf","i","replace","append","get","addClass","css","prop","getContext","initEvents","find","detach","parseInt","length","play","toFrame","clearTimeout","drawFrame","trigger","pause","stop","Deferred","resolve","progress","playBar","getCurrentPoint","target","e","originalEvent","touches","changedTouches","pageX","offset","left","progressOnMouseDown","indexOnMouseDown","mousePosOnMouseDown","curPosX","prevPosX","isRightDirection","on","preventDefault","Math","floor","mousePosOnMouseDownFrame","curPosXFrame","move","$img","cw","ch","iw","ih","vw","vh","clearRect","drawImage","setTimeout","ceil","drawProgress","fn","each","undefined","data","jQuery"],"mappings":"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","file":"sarine.plugin.imgplayer.min.js","sourcesContent":["(function($) {\r\n\r\n    $.imgplay = function(element, options) {\r\n        var defaults = {\r\n            totalImages: null,\r\n            imageName: null,                            \r\n            urlDir: null,\r\n            rate: null,\r\n            height: null,\r\n            width: null,\r\n            autoPlay: true\r\n        };\r\n\r\n        var el = element;\r\n        var $el = $(element);\r\n\r\n        var $canvas = null;\r\n        var screen = null;\r\n        var playing = false;\r\n        var direction = 'forward';\r\n        var page = 1;\r\n        var total = 0;\r\n        var index = 0;\r\n        var playTimer = null;\r\n        var loadProgress = 0;\r\n        var playProgress = 0;\r\n\r\n        var plugin = this;\r\n        plugin.settings = {};\r\n        plugin.frames = [];\r\n\r\n        plugin.init = function() {\r\n            plugin.settings = $.extend({}, defaults, options);\r\n            \r\n            // Check plugin options\r\n            Object.keys(plugin.settings).map(function(key, index) {\r\n                if (plugin.settings[key] === null) {\r\n                    console.error('Sarine imageplayer error: ' + key + ' is undefined in plugin configuration');\r\n                }\r\n            });\r\n\r\n            if (plugin.settings.urlDir.indexOf('{num}') === -1) {\r\n                console.error('Sarine imageplayer error: urlDir should contain {num} string in the image name, like: Image_{num}.jpg');\r\n            }\r\n\r\n            // Load images\r\n            var img;\r\n            total = plugin.settings.totalImages;\r\n            for (var i=1; i<=plugin.settings.totalImages; ++i) {\r\n                img = '<img class=\"imageplay_loaded\" src=\"' + plugin.settings.urlDir.replace('{num}', i) + '\" />';\r\n                $el.append(img);\r\n                plugin.frames[i] = $(img).get(0);\r\n            }\r\n            \r\n            $el.addClass('sarine_imgplay');\r\n            $el.css({height: options.height, width: options.width});\r\n\r\n            // Create canvas\r\n            $canvas = $('<canvas class=\"imgplay-canvas\">');\r\n            $canvas.prop({height: options.height, width: options.width});\r\n            \r\n            screen = $canvas.get(0).getContext('2d');\r\n            $el.append($canvas);\r\n            \r\n            initEvents();\r\n\r\n            // remove images from DOM\r\n            $el.find('img.imageplay_loaded').detach();\r\n\r\n            // default frame rate\r\n            if ( ! plugin.settings.rate ) {\r\n                plugin.settings.rate = parseInt(plugin.frames.length / 10);\r\n            }\r\n\r\n            // max rate is 100 fps and min rate is 0.001 fps\r\n            plugin.settings.rate = (plugin.settings.rate < 0.001) ? 0.001 : plugin.settings.rate;\r\n            plugin.settings.rate = (plugin.settings.rate > 100) ? 100 : plugin.settings.rate;\r\n\r\n            if (plugin.settings.autoPlay) {\r\n                plugin.play();\r\n            }\r\n            else {\r\n                plugin.toFrame(1);\r\n            }\r\n        };\r\n\r\n        plugin.play = function() {\r\n            playing = true;\r\n            if(playTimer != null) {\r\n                clearTimeout(playTimer);\r\n            }\r\n\r\n            drawFrame();\r\n            $el.trigger('play');\r\n        };\r\n\r\n        plugin.pause = function() {\r\n            playing = false;\r\n            if(playTimer != null) {\r\n                clearTimeout(playTimer);\r\n            }\r\n            $el.trigger('pause');\r\n        };\r\n\r\n        plugin.stop = function() {\r\n            playing = false;\r\n            index = 0;\r\n            plugin.play();\r\n            $el.trigger('stop', plugin);\r\n        };\r\n\r\n        plugin.toFrame = function(i) {\r\n            i = i < 0 ? 0 : i;\r\n\r\n            if (plugin.frames[i]) {\r\n                index = i;\r\n                drawFrame();\r\n                return $.Deferred().resolve();\r\n            }            \r\n        };\r\n\r\n        var initEvents = function() {\r\n            \r\n            var progress = $('<div class=\"imgplay-progress\" id=\"imgplay_move\">');\r\n            var playBar = $('<div class=\"imgplay-play-bar\">');\r\n          \r\n            function getCurrentPoint (target, e) {\r\n                \r\n                var touch = null, pageX = null;\r\n                if (e.originalEvent && e.originalEvent.touches) {\r\n                    touch = e.originalEvent && e.originalEvent.touches[0] || e.originalEvent.changedTouches[0];\r\n                    pageX = touch.pageX;\r\n                }\r\n                else {\r\n                    pageX = e.pageX;\r\n                }\r\n\r\n                return pageX - target.offset().left;\r\n            }\r\n\r\n            function startMove (e) {\r\n                plugin.pause();                    \r\n                progressOnMouseDown = true;\r\n                mousePosOnMouseDown = getCurrentPoint(progress, e); \r\n                indexOnMouseDown = index;                \r\n            }\r\n\r\n            function move (e) {\r\n                if ( ! progressOnMouseDown) return;\r\n\r\n                var target = progress;\r\n                var curPosX = getCurrentPoint(target, e);\r\n                                            \r\n                var width = target.width();\r\n                var frame = Math.floor(curPosX / width * total);\r\n                \r\n                isRightDirection = curPosX >= prevPosX;\r\n                if (isRightDirection) {\r\n                    direction = 'forward';\r\n                }\r\n                else {\r\n                    direction = 'backward';\r\n                }\r\n                \r\n                var mousePosOnMouseDownFrame = Math.floor(total / width * mousePosOnMouseDown);\r\n                var curPosXFrame = Math.floor(total / width * curPosX);\r\n                var offset;\r\n\r\n                if (curPosXFrame >= mousePosOnMouseDown) {\r\n                    offset = Math.floor(curPosXFrame - mousePosOnMouseDownFrame); \r\n                    index = indexOnMouseDown + offset;\r\n                }\r\n                else {\r\n                    offset = Math.floor(mousePosOnMouseDownFrame - curPosXFrame);\r\n                    index = indexOnMouseDown - offset;\r\n                }\r\n\r\n                if (index > total) {\r\n                    index = index - total;                                \r\n                }\r\n                else if (index < 1) {\r\n                    index = total + index;\r\n                }\r\n\r\n                plugin.toFrame(index);        \r\n                prevPosX = curPosX;\r\n            }\r\n\r\n            function finishMove () {\r\n                plugin.play();\r\n                progressOnMouseDown = false;\r\n            }\r\n\r\n            var progressOnMouseDown = false,\r\n                indexOnMouseDown = -1;\r\n                mousePosOnMouseDown = -1,\r\n                curPosX = 0,\r\n                prevPosX = 0,\r\n                isRightDirection = false;\r\n\r\n            progress\r\n                .on('mousedown touchstart', function(e) {\r\n                    e.preventDefault();\r\n                    startMove(e);                  \r\n                })\r\n                .on('mousemove touchmove', function(e) {\r\n                    e.preventDefault();\r\n                    move(e);\r\n                })\r\n                .on('mouseleave mouseup touchend', function(e) {\r\n                    finishMove(e);\r\n                });\r\n\r\n            progress.append(playBar);\r\n            $el.append(progress);\r\n        };\r\n\r\n        var drawFrame = function() {\r\n            if (screen != null) {\r\n                var img = plugin.frames[index];\r\n                var $img = $(img);\r\n\r\n                if (img && $img.prop('naturalHeight') > 0) {\r\n                    var cw = $canvas.width();\r\n                    var ch = $canvas.height();\r\n                    var iw = img.width;\r\n                    var ih = img.height;\r\n                    var vw = 0;\r\n                    var vh = 0;\r\n\r\n                    if (cw >= ch) {\r\n                        vw = iw * (ch/ih);\r\n                        vh = ch;\r\n                    } else {\r\n                        vw = cw;\r\n                        vh = ih * (cw/iw);\r\n                    }\r\n                    screen.clearRect(0, 0, cw, ch);\r\n                    screen.drawImage(img, (cw - vw) / 2, (ch - vh) / 2, vw, vh);                    \r\n                } \r\n\r\n                if (index > plugin.frames.length) {\r\n                    plugin.stop();\r\n                    return;\r\n                }\r\n\r\n                if (playing) {\r\n                    if (direction == 'forward') {\r\n                        index++;\r\n                    } \r\n                    else {\r\n                        index--;\r\n\r\n                        if (index < 0) {\r\n                            index = plugin.frames.length + index;\r\n                        }\r\n                    }\r\n\r\n                    playTimer = setTimeout(drawFrame, Math.ceil(1000 / plugin.settings.rate));\r\n                }\r\n\r\n                drawProgress();\r\n            }\r\n        };\r\n\r\n        var drawProgress = function() {\r\n            loadProgress = ((plugin.frames.length / total) * 100);\r\n            playProgress = ((index / plugin.frames.length) * 100);\r\n\r\n            loadProgress = loadProgress > 100 ? 100 : loadProgress;\r\n            playProgress = playProgress > 100 ? 100 : playProgress;\r\n\r\n            $el.find('.imgplay-play-bar').css('width',  playProgress + '%');\r\n        };\r\n\r\n        plugin.init();\r\n    };\r\n\r\n    $.fn.imgplay = function(options) {\r\n        this.each(function() {\r\n            if($(this).data('imgplay') == undefined) {\r\n                var plugin = new $.imgplay(this, options);\r\n                $(this).data('imgplay', plugin);\r\n            }\r\n        });\r\n\r\n        return this;\r\n    };\r\n})(jQuery);"]}